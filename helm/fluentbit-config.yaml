apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "django-app.fullname" . }}-fluentbit
  namespace: {{ .Values.global.namespace }}
data:
  fluent-bit.conf: |-
    [SERVICE]
        Parsers_File /fluent-bit/parsers/parsers.conf
    [INPUT]
        Name              tail
        Tag               kube.*
        Path              /var/log/containers/*{{ include "django-app.name" . }}*.log
        Parser            docker
        Mem_Buf_Limit     5MB
        Skip_Long_Lines   On
    [Output]
        Name              loki
        Match             kube.*
        Host              loki.monitoring.svc.cluster.local
        Port              3100
        Labels            app={{ include "django-app.name" . }}
